<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Конструктор испытаний - The Outlast Trials</title>
    <style>
        :root {
            --dark-bg: #0d0d0d;
            --accent-red: #cc0000;
            --text-primary: #e0e0e0;
            --section-bg: #1a1a1a;
            --focus-color: #ff4444;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            display: flex;
            gap: 30px;
        }

        .constructor-panel {
            width: 400px;
            min-height: 90vh;
            border-right: 2px solid #333;
            padding-right: 20px;
        }

        .selection-panel {
            flex: 1;
            padding-left: 20px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .selected-trial {
            background: var(--section-bg);
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            transition: all 0.3s;
        }

        .selected-trial:focus-within {
            outline: 2px solid var(--focus-color);
        }

        .selected-trial img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            margin-bottom: 15px;
        }

        .code-input-section {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .code-input {
            background: #252525;
            border: 1px solid #444;
            color: white;
            padding: 10px;
            flex: 1;
            transition: all 0.3s;
        }

        .code-input:focus {
            outline: 2px solid var(--focus-color);
            border-color: transparent;
        }

        .variator-slots {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .variator-slot {
            background: #252525;
            border: 2px dashed #444;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-direction: column;
            transition: all 0.3s;
        }

        .variator-slot.filled {
            border-style: solid;
            background: #330000;
            border-color: var(--accent-red);
        }

        .variator-slot:focus {
            outline: 2px solid var(--focus-color);
        }

        .category-header {
            font-size: 1.2em;
            color: var(--accent-red);
            margin: 20px 0 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #333;
        }

        .item-card {
            padding: 15px;
            background: #252525;
            margin: 10px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
        }

        .item-card:focus,
        .item-card:hover {
            outline: 2px solid var(--focus-color);
            transform: translateX(5px);
        }

        .item-card.active {
            background: #330000;
            border-left: 4px solid var(--focus-color);
        }

        button {
            background: #333;
            color: white;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:focus,
        button:hover {
            background: #444;
            outline: 2px solid var(--focus-color);
        }
    </style>
</head>
<body>
    <div class="constructor-panel">
        <h2>КОНСТРУКТОР ИСПЫТАНИЙ</h2>
        
        <div class="selected-trial" tabindex="0">
            <div id="trialContent">Выберите испытание</div>
            <button onclick="showMainMenu()" class="focusable">Изменить испытание</button>
        </div>

        <h3>ВАРИАТОРЫ (<span id="variatorCount">0</span>/6)</h3>
        <div class="variator-slots" id="variatorSlots"></div>

        <div class="code-input-section">
            <input type="text" class="code-input focusable" id="codeInput" placeholder="Введите код испытания">
            <button onclick="applyCode()" class="focusable">Применить</button>
        </div>
        <div class="code-input-section">
            <input type="text" class="code-input focusable" id="codeOutput" readonly>
            <button onclick="copyCode()" class="focusable">Копировать</button>
        </div>
    </div>

    <div class="selection-panel" id="selectionPanel"></div>

<script>
const trials = {
    long: [
        {
            id: 'L1',
            name: 'УБЕЙТЕ СТУКАЧА',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'images/L1.png'
        },
        {
            id: 'L2',
            name: 'Измельчите негодяев',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'L3',
            name: 'Причастите сирот',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'L4',
            name: 'Оправдать виновного',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'L5',
            name: 'Извратить футерманао',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'L6',
            name: 'Отравите лекарство',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'L7',
            name: 'Порадуйте прокурора',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'L8',
            name: 'Ликвидируйте профсоюз',
            desc: 'Доставьте стукача в камеру смерти',
            img: 'https://via.placeholder.com/200x120'
        }
    ],
    short: [
        {
            id: 'S1',
            name: 'Отмените вскрытие',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S2',
            name: 'Cаботируйте карантин',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S3',
            name: 'уничтожьте прошлое',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S4',
            name: 'Освободите заключённых',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S5',
            name: 'обучите полицейского',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S6',
            name: 'накажите негодяев',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S7',
            name: 'Откройте ворота',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S8',
            name: 'сломайте футерманов',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S9',
            name: 'просверлить футермана',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S10',
            name: 'накормить детей',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S11',
            name: 'приютите сирот',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S12',
            name: 'воссоедините семью',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S13',
            name: 'Соберите детей божьих',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S14',
            name: 'сбегите из суда',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S15',
            name: 'уничтожьте улики',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S16',
            name: 'запятая отпирающий механизм',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S17',
            name: 'склоните Весы правосудия',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S18',
            name: 'раздавите секс игрушки',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S19',
            name: 'сожгите секс игрушки',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S20',
            name: 'Прекратите работу фабрики',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S21',
            name: 'опустошите хранилище',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S22',
            name: 'отравите скот',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S23',
            name: 'Спрячьте контрабанду',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S24',
            name: 'поджарьте информатора',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S25',
            name: 'похитьте любовницу',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },
        {
            id: 'S26',
            name: 'Распространите болезнь',
            desc: 'Экстренная эвакуация объекта',
            img: 'https://via.placeholder.com/200x120'
        },

    ]
};

const variatorGroups = [
    {
        name: 'Особые события',
        items: [
            {
                id: 'V1',
                name: 'Сильнее вместе',
                desc: 'Держитесь поближе к своим друзьям или получайте урон! Диапазон голосового чата ограничен',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V3']
            },
            {
                id: 'V2',
                name: 'Резкая похолодание',
                desc: 'Зона испытания периодически заполняется обжигающе холодным воздухом! Прячьтесь, чтобы выжить',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V3']
            },
            {
                id: 'V3',
                name: 'Токсический шок',
                desc: 'Место испытания иногда заполняется токсичным газом нанося всем постоянный урон. Чтобы выжить прячьтесь',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V3']
            },
            {
                id: 'V4',
                name: 'Таймер бомбы',
                desc: 'На каждом реагенте закреплена взрывчатка с таймером',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V3']
            },
            {
                id: 'V5',
                name: 'Франка Барби',
                desc: 'В испытании появляется Франко Барби',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V3']
            },
            {
                id: 'V6',
                name: 'Самое главное',
                desc: 'В испытании участвует несколько главных активов',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V3']
            },
        ]
    },
    {
        name: 'Побочное задание',
        items: [
            {
                id: 'SQ1',
                name: 'Cбор подарков',
                desc: 'Найдите все подарки в испытании',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            },
            {
                id: 'SQ2',
                name: 'Сбор крыс',
                desc: 'Найдите всех одурманенных крыс в испытании',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            },
            {
                id: 'SQ3',
                name: 'Извлеките образцы органов',
                desc: 'Найдите погибших реагентов и извлеките образцы органов для анализа',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            },
            {
                id: 'SQ4',
                name: 'Разбейте телевизоры',
                desc: 'Разбейте все неисправные телевизоры',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            },
            {
                id: 'SQ5',
                name: 'Находите радиопередатчики',
                desc: 'Находите в испытаниях радиопередатчики И прекращайте их вещание',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            },
            {
                id: 'SQ6',
                name: 'Найдите трансляцию',
                desc: 'В испытании вам оставили сообщения Найдите трансляцию и уничтожьте',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            },
            {
                id: 'SQ7',
                name: 'Собирайте схемы',
                desc: 'Соберитесь схемы в испытании',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            },
        ]
    },
    {
        name: 'Наборы',
        items: [
            {
                id: 'V2',
                name: 'Электрические барьеры',
                desc: 'Ловушки с высоким напряжением',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            }
        ]
    },
    {
        name: 'Ловушки',
        items: [
            {
                id: 'V2',
                name: 'Электрические барьеры',
                desc: 'Ловушки с высоким напряжением',
                img: 'https://via.placeholder.com/80x60',
                conflicts: ['V5']
            }
        ]
    }
];

let currentState = {
    selectedTrial: null,
    selectedVariators: new Map()
};

function init() {
    createSlots();
    showMainMenu();
    setupFocusHandlers();
}

function createSlots() {
    const slotsContainer = document.getElementById('variatorSlots');
    for(let i = 1; i <= 6; i++) {
        const slot = document.createElement('div');
        slot.className = 'variator-slot focusable';
        slot.dataset.slot = i;
        slot.tabIndex = 0;
        slot.onclick = () => showVariatorCategories();
        slotsContainer.appendChild(slot);
    }
}

function setupFocusHandlers() {
    // Добавляем обработчики для всех фокусируемых элементов
    document.querySelectorAll('.focusable').forEach(el => {
        el.addEventListener('focus', () => {
            el.classList.add('focused');
        });
        el.addEventListener('blur', () => {
            el.classList.remove('focused');
        });
    });
}

function showMainMenu() {
    const html = `
        <div class="category-header">ТИПЫ ИСПЫТАНИЙ</div>
        ${Object.entries(trials).map(([type, items]) => `
            <div class="item-card focusable" tabindex="0" onclick="showTrials('${type}')">
                <div>
                    <h3>${type.toUpperCase()}</h3>
                    <p>${items.length} вариантов</p>
                </div>
            </div>
        `).join('')}
    `;
    document.getElementById('selectionPanel').innerHTML = html;
    setupFocusHandlers();
}

function showTrials(type) {
    const html = `
        <div class="category-header">${type.toUpperCase()}</div>
        ${trials[type].map(trial => `
            <div class="item-card focusable" tabindex="0" onclick="selectTrial('${trial.id}')">
                <img src="${trial.img}" alt="${trial.name}">
                <div>
                    <h3>${trial.name}</h3>
                    <p>${trial.desc}</p>
                </div>
            </div>
        `).join('')}
    `;
    document.getElementById('selectionPanel').innerHTML = html;
    setupFocusHandlers();
}

function selectTrial(trialId) {
    const trial = [...trials.long, ...trials.short].find(t => t.id === trialId);
    currentState.selectedTrial = trial;
    
    document.getElementById('trialContent').innerHTML = `
        <img src="${trial.img}" alt="${trial.name}">
        <h3>${trial.name}</h3>
        <p>${trial.desc}</p>
    `;
    updateCode();
}

function showVariatorCategories() {
    const html = `
        <div class="category-header">КАТЕГОРИИ ВАРИАТОРОВ</div>
        ${variatorGroups.map(group => `
            <div class="item-card focusable" tabindex="0" onclick="showVariators('${group.name}')">
                <div>
                    <h3>${group.name}</h3>
                    <p>${group.items.length} вариантов</p>
                </div>
            </div>
        `).join('')}
    `;
    document.getElementById('selectionPanel').innerHTML = html;
    setupFocusHandlers();
}

function showVariators(groupName) {
    const group = variatorGroups.find(g => g.name === groupName);
    const html = `
        <div class="category-header">${groupName}</div>
        ${group.items.map(variator => `
            <div class="item-card focusable" tabindex="0" onclick="selectVariator('${variator.id}')">
                <img src="${variator.img}" alt="${variator.name}">
                <div>
                    <h3>${variator.name}</h3>
                    <p>${variator.desc}</p>
                </div>
            </div>
        `).join('')}
    `;
    document.getElementById('selectionPanel').innerHTML = html;
    setupFocusHandlers();
}

function selectVariator(variatorId, specificSlot = null) {
    const variator = variatorGroups.flatMap(g => g.items).find(v => v.id === variatorId);
    const slot = specificSlot || document.querySelector(`.variator-slot:not(.filled)`);
    
    if (!slot || currentState.selectedVariators.size >= 6) return;
    
    checkConflicts(variator);
    
    slot.classList.add('filled');
    slot.innerHTML = `
        <img src="${variator.img}" style="width:50px;height:35px">
        <div>${variator.name}</div>
    `;
    
    currentState.selectedVariators.set(slot.dataset.slot, variator);
    updateInterface();
    slot.focus();
}

function checkConflicts(newVariator) {
    currentState.selectedVariators.forEach((existing, slot) => {
        if (existing.conflicts?.includes(newVariator.id)) {
            currentState.selectedVariators.delete(slot);
            document.querySelector(`[data-slot="${slot}"]`).classList.remove('filled');
        }
    });
}

function updateInterface() {
    document.getElementById('variatorCount').textContent = currentState.selectedVariators.size;
    updateCode();
}

function updateCode() {
    const trialCode = currentState.selectedTrial?.id || 'XXXX';
    const variatorCodes = Array.from(currentState.selectedVariators.values())
                            .map(v => v.id.substring(1)).join('');
    const fullCode = `КОД ИСПЫТАНИЯ: ${trialCode}${variatorCodes}`;
    document.getElementById('codeOutput').value = fullCode;
}

function applyCode() {
    const code = document.getElementById('codeInput').value.replace('КОД ИСПЫТАНИЯ: ', '');
    const trialId = code.substring(0, 2);
    const variatorIds = code.substring(2).match(/.{2}/g) || [];
    
    currentState.selectedTrial = null;
    currentState.selectedVariators.clear();
    document.querySelectorAll('.variator-slot').forEach(slot => {
        slot.classList.remove('filled');
        slot.innerHTML = '';
    });

    const trial = [...trials.long, ...trials.short].find(t => t.id === trialId);
    if(trial) {
        selectTrial(trial.id);
        document.querySelector('.selected-trial').focus();
    }
    
    variatorIds.forEach((vid, index) => {
        const variator = variatorGroups.flatMap(g => g.items).find(v => v.id === `V${vid}`);
        if(variator && index < 6) {
            const slot = document.querySelector(`[data-slot="${index + 1}"]`);
            if(slot) selectVariator(variator.id, slot);
        }
    });
}

function copyCode() {
    const codeOutput = document.getElementById('codeOutput');
    codeOutput.select();
    document.execCommand('copy');
    alert('Код скопирован в буфер обмена!');
    codeOutput.blur();
}

init();
</script>
</body>
</html>